<html>
    <head>
        <script type="text/javascript" src="jsExtender.js"></script>
        <style>
            body {
                font-family: monospace;
            }

            .outputHeader {
                font-weight: bold;
                font-size: 15px;
            }

            .outputContent {

            }

            #output {
                border: 1px solid black;
                min-height: 25px;
                padding: 6px;
            }
        </style>
    </head>
    <body>
        <div class="outputHeader">jsExtenderExamples Output:</div>
        <div id="output"></div>
        <!---
        <script type="text/javascript" src="jsExtenderExamples.js"></script>
        -->
        <script>
            var getPrototype = Object.getPrototypeOf;

            function isObjectConstructor(func) {
                return Object.prototype.constructor === func;
            }

            function isUndefined(prop) {
                return typeof (prop) === 'undefined';
            }

            function isUndefinedOrNull(prop) {
                return isUndefined(prop) || prop == null;
            }

            function isObject(obj) {
                return typeof (obj) === 'object';
            }

            function isFunction(obj) {
                return typeof (obj) === 'function';
            }

            function getBaseConstructor(child, base) {
                function defaultConstructor() { }

                var c = defaultConstructor,
                    b = defaultConstructor;

                if (isUndefinedOrNull(child) || !isFunction(child.constructor)) {
                    return defaultConstructor;
                }

                var invalidConstructor = isObjectConstructor(child.constructor);

                if (!invalidConstructor)
                    c = child.constructor;

                if (!isUndefinedOrNull(base) && isFunction(base.constructor)) {
                    b = base.constructor;
                }

                return function func() {
                    b.apply(this, arguments);
                    c.apply(this, arguments);
                };
            }

            function test1() {
                this.inheritedVar1 = 'testing';
                this.inheritedVar4 = this.inheritedVar2;
            }

            test1.testFunc = function () {
                console.log('Testing testFunc from test1');
            };

            test1.constructor = test1;
            test1.prototype.testFuncProto = function () {
                console.log('Testing testFuncProto from test1');
            };

            function test2() {

            }

            /*var con = getBaseConstructor(test1, {
                constructor: function () {
                    // test constructor 2.
                }
            });

            console.log(con);

            con = getBaseConstructor({
                constructor: function () {
                    // test constructor 2.
                }
            }, test1);

            console.log(con);

            con = getBaseConstructor({
                constructor: function () {
                    // test constructor 2.
                }
            }, {});

            console.log(con);
            */

            var t1 = new test1(),
                t2 = new test2();

            console.log(t1);
            console.log(t2);

            function inheritTest1() {
                this.inheritedVar2 = 'test';
                this.inheritedVar3 = this.inheritedVar1;
            }

            inheritTest1.testFunc2 = function () {
                console.log('Testing testFunc2 from inheritTest1');
            }

            inheritTest1.prototype.testFunc2Proto = function () {
                console.log('Testing testFunc2Proto from inheritTest1');
            }

            function makeProto(p) {
                if (typeof (p) !== 'object')
                    throw TypeError('Argument must be an object.');

                function func() {}
                func.prototype = p;
                var result = new func();
                return result;
            }

            function copyProperties(p, sourceClass, baseClass) {
                var propertyNames = jsExtender.getOwnPropertyNames(sourceClass);

                for (var i = 0; i < propertyNames.length; i++) {
                    var name = propertyNames[i];

                    if (name === 'constructor')
                        continue;

                    //if (name !== 'constructor' && isFunction(baseClass[name]) && isFunction(sourceClass[name])) {
                    //p[p] = buildWrappedFunction(p, baseClass, sourceClass);
                    //} else {
                    p[name] = sourceClass[name];
                    //}
                }
            }

            function makeClass(child, base) {
                var inheritProto = getBaseConstructor(child.prototype, base.prototype);
                inheritProto.prototype = makeProto(base.prototype);
                inheritProto.prototype.constructor = inheritProto;

                copyProperties(inheritProto.prototype, child.prototype, base);

                return inheritProto;
            }

            var inheritProto = makeClass(inheritTest1, test1);

            /*
            con = getBaseConstructor(inheritTest1, { 
                constructor: function () {}
            });

            console.log(con);
            */
            var i1 = new inheritProto();

            i1.testFuncProto();
            i1.testFunc2Proto();

            var p1 = getPrototype(i1);
            while (p1) {
                console.log(p1);
                p1 = getPrototype(p1);
            }

            function inheritTest2 () {

            }

            inheritTest2.prototype.testFunc3 = function () {
                console.log('Testing testFunc3.');
            };

            var inheritProto2 = makeClass(inheritTest2, inheritProto);

            var i2 = new inheritProto2();
                i2.testFuncProto();
                i2.testFunc2Proto();
                i2.testFunc3();

            p1 = getPrototype(i2);
            while (p1) {
                console.log(p1);
                p1 = getPrototype(p1);
            }

            var test1 = jsExtender({
                constructor: function() {
                    this.test1 = true;
                },
                func1: function () {
                    console.log('testing func1.');
                }
            });

            function test2Base() {
                this.test2 = true;
                test2.prototype.func = function() {
                    console.log('testing func base2.' + this.test4);
                };
                
                this.func = this.wrapFunction('func');
            }

            test2Base.prototype.func1 = function () {
                console.log('testing func3.');
                this.parent.func1();
            };

            var test2 = test1.extend(test2Base);

            function test3Base() {
                this.test2 = true;
                test3.prototype.func = function() {
                    console.log('testing func base3.' + this.test4);
                    this.base();
                };
                
                this.func = this.wrapFunction('func');
            }

            test3Base.prototype.func1 = function () {
                console.log('testing func4.');
                this.parent.func1();
            };

            var test3 = test2.extend(test3Base);

            var t1 = new test1(),
                t2 = test2.create(),
                t3 = test3.create();

            t2.func();
            t2.func1();
            t3.func();
            t3.func1();

            var test4 = test3.extend({
                constructor: function () {
                    var privateVar = 3;

                    this.test4 = 'Variable from test4.';

                    test4.prototype.func1 = function () {
                        console.log('func1 from test4 constructor.' + privateVar);
                        this.parent.func1();
                    };
                },
                func: function() {
                    console.log('func from test4.' + this.test4);
                    this.base();
                },
                func1: function() {
                    console.log('func1 from test4.');
                    this.parent.func1();
                }
            });

            var t4 = test4.create();
                t4.func();
                t4.func1();
        </script>
    </body>
</html>